(function(t){"use strict";var e,n,r;e=function(){function e(e,n,r){var i;this.row=e;this.tree=n;this.settings=r;this.id=this.row.data(this.settings.nodeIdAttr);i=this.row.data(this.settings.parentIdAttr);if(i!=null&&i!==""){this.parentId=i}this.treeCell=t(this.row.children(this.settings.columnElType)[this.settings.column]);this.expander=t(this.settings.expanderTemplate);this.indenter=t(this.settings.indenterTemplate);this.cell=t(this.settings.cellTemplate);this.children=[];this.initialized=false;this.treeCell.prepend(this.indenter);this.treeCell.wrapInner(this.cell)}e.prototype.addChild=function(t){return this.children.push(t)};e.prototype.ancestors=function(){var t,e;e=this;t=[];while(e=e.parentNode()){t.push(e)}return t};e.prototype.collapse=function(){if(this.collapsed()){return this}this.row.removeClass("expanded").addClass("collapsed");this._hideChildren();this.expander.attr("title",this.settings.stringExpand);if(this.initialized&&this.settings.onNodeCollapse!=null){this.settings.onNodeCollapse.apply(this)}return this};e.prototype.collapsed=function(){return this.row.hasClass("collapsed")};e.prototype.expand=function(){if(this.expanded()){return this}this.row.removeClass("collapsed").addClass("expanded");if(this.initialized&&this.settings.onNodeExpand!=null){this.settings.onNodeExpand.apply(this)}if(t(this.row).is(":visible")){this._showChildren()}this.expander.attr("title",this.settings.stringCollapse);return this};e.prototype.expanded=function(){return this.row.hasClass("expanded")};e.prototype.hide=function(){this._hideChildren();this.row.hide();return this};e.prototype.isBranchNode=function(){if(this.children.length>0||this.row.data(this.settings.branchAttr)===true){return true}else{return false}};e.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch");this.row.removeClass("leaf");this.row.addClass(this.isBranchNode()?"branch":"leaf")};e.prototype.level=function(){return this.ancestors().length};e.prototype.parentNode=function(){if(this.parentId!=null){return this.tree[this.parentId]}else{return null}};e.prototype.removeChild=function(e){var n=t.inArray(e,this.children);return this.children.splice(n,1)};e.prototype.render=function(){var e,n=this.settings,r;if(n.expandable===true&&this.isBranchNode()){e=function(e){t(this).parents("table").treetable("node",t(this).parents("tr").data(n.nodeIdAttr)).toggle();return e.preventDefault()};this.indenter.html(this.expander);r=n.clickableNodeNames===true?this.treeCell:this.expander;r.off("click.treetable").on("click.treetable",e);r.off("keydown.treetable").on("keydown.treetable",function(t){if(t.keyCode==13){e.apply(this,[t])}})}this.indenter[0].style.paddingLeft=""+this.level()*n.indent+"px";return this};e.prototype.reveal=function(){if(this.parentId!=null){this.parentNode().reveal()}return this.expand()};e.prototype.setParent=function(t){if(this.parentId!=null){this.tree[this.parentId].removeChild(this)}this.parentId=t.id;this.row.data(this.settings.parentIdAttr,t.id);return t.addChild(this)};e.prototype.show=function(){if(!this.initialized){this._initialize()}this.row.show();if(this.expanded()){this._showChildren()}return this};e.prototype.toggle=function(){if(this.expanded()){this.collapse()}else{this.expand()}return this};e.prototype._hideChildren=function(){var t,e,n,r,i;r=this.children;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.hide())}return i};e.prototype._initialize=function(){var t=this.settings;this.render();if(t.expandable===true&&t.initialState==="collapsed"){this.collapse()}else{this.expand()}if(t.onNodeInitialized!=null){t.onNodeInitialized.apply(this)}return this.initialized=true};e.prototype._showChildren=function(){var t,e,n,r,i;r=this.children;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.show())}return i};return e}();n=function(){function n(t,e){this.table=t;this.settings=e;this.tree={};this.nodes=[];this.roots=[]}n.prototype.collapseAll=function(){var t,e,n,r,i;r=this.nodes;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.collapse())}return i};n.prototype.expandAll=function(){var t,e,n,r,i;r=this.nodes;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.expand())}return i};n.prototype.findLastNode=function(t){if(t.children.length>0){return this.findLastNode(t.children[t.children.length-1])}else{return t}};n.prototype.loadRows=function(n){var r,i,s;if(n!=null){for(s=0;s<n.length;s++){i=t(n[s]);if(i.data(this.settings.nodeIdAttr)!=null){r=new e(i,this.tree,this.settings);this.nodes.push(r);this.tree[r.id]=r;if(r.parentId!=null&&this.tree[r.parentId]){this.tree[r.parentId].addChild(r)}else{this.roots.push(r)}}}}for(s=0;s<this.nodes.length;s++){r=this.nodes[s].updateBranchLeafClass()}return this};n.prototype.move=function(e,n){var r=e.parentNode();if(e!==n&&n.id!==e.parentId&&t.inArray(e,n.ancestors())===-1){e.setParent(n);this._moveRows(e,n);if(e.parentNode().children.length===1){e.parentNode().render()}}if(r){r.updateBranchLeafClass()}if(e.parentNode()){e.parentNode().updateBranchLeafClass()}e.updateBranchLeafClass();return this};n.prototype.removeNode=function(e){this.unloadBranch(e);e.row.remove();if(e.parentId!=null){e.parentNode().removeChild(e)}delete this.tree[e.id];this.nodes.splice(t.inArray(e,this.nodes),1);return this};n.prototype.render=function(){var t,e,n,r;r=this.roots;for(e=0,n=r.length;e<n;e++){t=r[e];t.show()}return this};n.prototype.sortBranch=function(t,e){t.children.sort(e);this._sortChildRows(t);return this};n.prototype.unloadBranch=function(t){var e=t.children.slice(0),n;for(n=0;n<e.length;n++){this.removeNode(e[n])}t.children=[];t.updateBranchLeafClass();return this};n.prototype._moveRows=function(t,e){var n=t.children,r;t.row.insertAfter(e.row);t.render();for(r=n.length-1;r>=0;r--){this._moveRows(n[r],t)}};n.prototype._sortChildRows=function(t){return this._moveRows(t,t)};return n}();r={init:function(e,r){var i;i=t.extend({branchAttr:"ttBranch",clickableNodeNames:false,column:0,columnElType:"td",expandable:false,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",cellTemplate:"",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},e);return this.each(function(){var e=t(this),r;r=new n(this,i);r.loadRows(this.rows).render();e.addClass("treetable").data("treetable",r);if(i.onInitialized!=null){i.onInitialized.apply(r)}return e})},destroy:function(){return this.each(function(){return t(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){this.data("treetable").collapseAll();return this},collapseNode:function(t){var e=this.data("treetable").tree[t];if(e){e.collapse()}else{throw new Error("Unknown node '"+t+"'")}return this},expandAll:function(){this.data("treetable").expandAll();return this},expandNode:function(t){var e=this.data("treetable").tree[t];if(e){if(!e.initialized){e._initialize()}e.expand()}else{throw new Error("Unknown node '"+t+"'")}return this},loadBranch:function(e,n){var r=this.data("treetable").settings,i=this.data("treetable").tree;n=t(n);if(e==null){this.append(n)}else{var s=this.data("treetable").findLastNode(e);n.insertAfter(s.row)}this.data("treetable").loadRows(n);n.filter("tr").each(function(){i[t(this).data(r.nodeIdAttr)].show()});if(e!=null){e.render().expand()}return this},move:function(t,e){var n,r;r=this.data("treetable").tree[t];n=this.data("treetable").tree[e];this.data("treetable").move(r,n);return this},node:function(t){return this.data("treetable").tree[t]},removeNode:function(t){var e=this.data("treetable").tree[t];if(e){this.data("treetable").removeNode(e)}else{throw new Error("Unknown node '"+t+"'")}return this},reveal:function(t){var e=this.data("treetable").tree[t];if(e){e.reveal()}else{throw new Error("Unknown node '"+t+"'")}return this},sortBranch:function(e,n){var r=this.data("treetable").settings,i,s;n=n||r.column;s=n;if(t.isNumeric(n)){s=function(e,r){var i,s,a;i=function(e){var r=e.row.find("td:eq("+n+")").text();return t.trim(r).toUpperCase()};s=i(e);a=i(r);if(s<a)return-1;if(s>a)return 1;return 0}}this.data("treetable").sortBranch(e,s);return this},unloadBranch:function(t){this.data("treetable").unloadBranch(t);return this}};t.fn.treetable=function(e){if(r[e]){return r[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return r.init.apply(this,arguments)}else{return t.error("Method "+e+" does not exist on jQuery.treetable")}};window.TreeTable||(window.TreeTable={});window.TreeTable.Node=e;window.TreeTable.Tree=n})(jQuery);